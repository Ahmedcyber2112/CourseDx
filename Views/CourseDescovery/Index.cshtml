@model CourseDx.Models.CourseDiscoveryViewModel
@{
    ViewData["Developer"] = "CourseDx Developers";
    int totalCoursesCount = Model.Courses.Count();
    int currentPage = Context.Request.Query["page"].FirstOrDefault() is string pageStr && int.TryParse(pageStr, out int page) ? page : 1;
    int itemsPerPage = 6;
    int startingIndex = (currentPage - 1) * itemsPerPage;
    int showingItemCount = Math.Min(itemsPerPage, totalCoursesCount - (currentPage - 1) * itemsPerPage);
    int totalPages = (int)Math.Ceiling((double)totalCoursesCount / itemsPerPage);

    // Extract unique course names for category filter
    var uniqueCourseNames = Model.Courses
        .Select(c => c.Name)
        .Distinct()
        .OrderBy(name => name)
        .ToList();
}
<!-- Main Content -->
<main class="pt-20 min-h-screen flex flex-col overflow-hidden relative bg-white dark:bg-gray-900">
    <!-- Background elements -->
    <div class="fixed top-0 left-0 w-full h-full opacity-20 z-10 pointer-events-none">
        <div class="absolute top-1/4 left-1/4 w-64 h-64 bg-yellow-400 rounded-full filter blur-3xl animate-pulse-slow opacity-40"></div>
        <div class="absolute bottom-1/4 right-1/4 w-96 h-96 bg-purple-500 rounded-full filter blur-3xl opacity-50 animate-pulse-slow delay-1000"></div>
    </div>

    <!-- Page Header -->
    <section class="w-full py-12 md:py-16 relative z-10">
        <div class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="text-center">
                <h1 class="text-3xl md:text-4xl font-bold text-gray-900 dark:text-white">
                    Discover Your Next <span class="text-transparent bg-clip-text bg-gradient-to-r from-yellow-500 to-yellow-600">Course</span>
                </h1>
                <p class="mt-4 text-lg text-gray-600 dark:text-gray-300 max-w-2xl mx-auto">
                    Explore our extensive library of courses to advance your career and skills
                </p>
            </div>
        </div>
    </section>

    <!-- Search and Filter Section -->
    <section class="w-full py-6 relative z-10">
        <div class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6 border border-yellow-500/20">
                <div class="flex flex-col md:flex-row gap-4">
                    <!-- Search Input -->
                    <div class="flex-1">
                        <div class="relative">
                            <input type="text"
                                   id="course-search"
                                   placeholder="Search courses, topics, or instructors..."
                                   class="w-full bg-gray-50 dark:bg-gray-700 text-gray-800 dark:text-gray-200 rounded-lg px-4 py-3 pl-10 focus:outline-none focus:ring-2 focus:ring-yellow-500">
                            <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                                <i class="fas fa-search text-gray-500"></i>
                            </div>
                        </div>
                    </div>

                    <!-- Category Filter -->
                    <div class="w-full md:w-64">
                        <select id="category-filter" class="w-full cursor-pointer bg-gray-50 dark:bg-gray-700 text-gray-800 dark:text-gray-200 rounded-lg px-4 py-3 focus:outline-none focus:ring-2 focus:ring-yellow-500">
                            <option value="">All Courses</option>
                            @foreach (var courseName in uniqueCourseNames)
                            {
                                <option value="@courseName">@courseName</option>
                            }
                        </select>
                    </div>

                    <!-- Sort Filter -->
                    <div class="w-full md:w-48">
                        <select id="sort-filter" class="w-full cursor-pointer bg-gray-50 dark:bg-gray-700 text-gray-800 dark:text-gray-200 rounded-lg px-4 py-3 focus:outline-none focus:ring-2 focus:ring-yellow-500">
                            <option value="popular">Most Popular</option>
                            <option value="newest">Newest First</option>
                            <option value="rating">Highest Rated</option>
                            <option value="price-low">Price: Low to High</option>
                            <option value="price-high">Price: High to Low</option>
                        </select>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Course Grid -->
    <section class="w-full py-8 relative z-10">
        <div class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-2xl font-bold text-gray-900 dark:text-white">All Courses</h2>
                <p class="text-gray-600 dark:text-gray-400">Showing @showingItemCount of @totalCoursesCount courses</p>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8" id="course-container">
                @for (int i = startingIndex; i < Math.Min(startingIndex + itemsPerPage, totalCoursesCount); i++)
                {
                    var course = Model.Courses[i];
                    var courseDetail = course.CourseDetals?.FirstOrDefault();
                    var instructorName = courseDetail?.Instractor?.Name ?? "Instructor Name";
                    var coursePrice = courseDetail?.Price ?? 0;
                    var oldPrice = coursePrice + 75;
                    var courseDescription = courseDetail?.Description ?? "Course description not available";
                    int imageIndex = (i % 6) + 1;
                    string baseImageName = $"c-{imageIndex}";
                    string baseInstructorImageName = $"m{i + 1}";

                    string courseImageUrl = Url.Content($"~/img/{baseImageName}.webp");
                    string instructorImageUrl = Url.Content($"~/img/{baseInstructorImageName}.jpg");

                    <div class="flex flex-col justify-between bg-white dark:bg-gray-800 border border-gray-200 dark:border-yellow-500/20 rounded-xl overflow-hidden transition-all duration-300 course-card shadow-lg"
                         data-course-name="@course.Name">
                        <a asp-controller="Home" asp-action="Enrollment"
                           asp-route-imgurl="@baseImageName"
                           asp-route-title="@course.Name"
                           asp-route-instructor="@instructorName"
                           asp-route-oldprice="@oldPrice"
                           asp-route-actualprice="@coursePrice">
                            <div class="relative">
                                <img srcset="@(Url.Content($"~/img/400w/{baseImageName}-400.webp")) 400w,
                                     @(Url.Content($"~/img/800w/{baseImageName}-800.webp")) 800w,
                                     @(Url.Content($"~/img/1200w/{baseImageName}-1200.webp")) 1200w"
                                     sizes="(max-width: 600px) 400px,
                                    (max-width: 1024px) 800px,
                                    1200px"
                                     src="@courseImageUrl"
                                     alt="@course.Name"
                                     class="w-full h-48 object-cover transition-transform duration-300" />

                                <div class="absolute top-4 right-4 bg-yellow-500 text-gray-900 px-3 py-1 rounded-full text-sm font-bold">
                                    25% OFF
                                </div>
                            </div>
                        </a>
                        <div class="p-6">
                            <div class="flex justify-between items-start mb-3">
                                <a asp-controller="Home" asp-action="Enrollment"
                                   asp-route-imgurl="@baseImageName"
                                   asp-route-title="@course.Name"
                                   asp-route-instructor="@instructorName"
                                   asp-route-oldprice="@oldPrice"
                                   asp-route-actualprice="@coursePrice"
                                   class="text-xl font-bold text-gray-900 dark:text-gray-100 hover:text-yellow-600 dark:hover:text-yellow-400 transition-colors duration-300">
                                    @course.Name
                                </a>
                                <div class="flex items-center bg-yellow-500/10 px-2 py-1 rounded">
                                    <i class="fas fa-star text-yellow-600 mr-1"></i>
                                    <span class="text-sm font-bold text-yellow-600 dark:text-yellow-500">4.9</span>
                                </div>
                            </div>
                            <p class="text-gray-700 dark:text-gray-400 mb-4 line-clamp-2">
                                @courseDescription
                            </p>
                            <div class="flex justify-between items-center mb-4">
                                <div class="flex items-center gap-2">
                                    <a asp-controller="Home" asp-action="Enrollment"
                                       asp-route-imgurl="@courseImageUrl"
                                       asp-route-title="@course.Name"
                                       asp-route-instructor="@instructorName"
                                       asp-route-oldprice="@oldPrice"
                                       asp-route-actualprice="@coursePrice"
                                       class="flex items-center gap-2">
                                        <img src="@instructorImageUrl"  
                                             alt="@instructorName"
                                             class="w-8 h-8 rounded-full" />
                                        <span class="text-sm cursor-pointer text-gray-700 dark:text-gray-300">@instructorName</span>
                                    </a>
                                </div>

                                <span class="text-gray-600 dark:text-gray-400 text-sm">12 Weeks</span>
                            </div>
                            <div class="flex justify-between items-center">
                                <a asp-controller="Home" asp-action="Enrollment"
                                   asp-route-imgurl="@courseImageUrl"
                                   asp-route-title="@course.Name"
                                   asp-route-instructor="@instructorName"
                                   asp-route-oldprice="@oldPrice"
                                   asp-route-actualprice="@coursePrice">
                                    <div>
                                        <span class="text-lg font-bold text-yellow-400 line-through">$@oldPrice</span>
                                        <span class="text-xl font-bold text-yellow-600 dark:text-yellow-500 ml-2">$@coursePrice</span>
                                    </div>
                                </a>
                                <a class="bg-gradient-to-r cursor-pointer from-yellow-400 to-yellow-600 text-gray-900 px-4 py-2 rounded-lg font-medium hover:opacity-90 transition-opacity"
                                   asp-controller="Home" asp-action="Enrollment"
                                   asp-route-imgurl="@courseImageUrl"
                                   asp-route-title="@course.Name"
                                   asp-route-instructor="@instructorName"
                                   asp-route-oldprice="@oldPrice"
                                   asp-route-actualprice="@coursePrice">
                                    Enroll Now
                                </a>
                            </div>
                        </div>
                    </div>
                }
            </div>

            <!-- Pagination -->
            <div class="mt-12 flex justify-center">
                <nav class="flex items-center space-x-2">
                    @if (currentPage > 1)
                    {
                        <a href="?page=@(currentPage - 1)" class="px-3 py-2 rounded-md bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:bg-yellow-500 hover:text-gray-900">
                            <i class="fas fa-chevron-left"></i>
                        </a>
                    }

                    @for (int pageNumber = 1; pageNumber <= totalPages; pageNumber++)
                    {
                        <a href="/CourseDescovery?page=@pageNumber" class="px-4 py-2 rounded-md bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:bg-yellow-500 hover:text-gray-900">@pageNumber</a>

                    }

                    @if (currentPage < totalPages)
                    {
                        <a href="?page=@(currentPage + 1)" class="px-3 py-2 rounded-md bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:bg-yellow-500 hover:text-gray-900">
                            <i class="fas fa-chevron-right"></i>
                        </a>
                    }
                </nav>
            </div>
        </div>
    </section>
</main>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        const categoryFilter = document.getElementById('category-filter');
        const courseCards = document.querySelectorAll('.course-card');
        const courseContainer = document.getElementById('course-container');

        categoryFilter.addEventListener('change', function() {
            const selectedCourse = this.value.toLowerCase();

            courseCards.forEach(card => {
                const courseName = card.getAttribute('data-course-name').toLowerCase();
                if (selectedCourse === '' || courseName.includes(selectedCourse)) {
                    card.style.display = 'block';
                } else {
                    card.style.display = 'none';
                }
            });

            // Update showing item count
            updateShowingCount();
        });

        function updateShowingCount() {
            const visibleCards = document.querySelectorAll('.course-card:not([style*="display: none"])').length;
            const totalCount = @totalCoursesCount;
            document.querySelector('p.text-gray-600').textContent =
                `Showing ${visibleCards} of ${totalCount} courses`;
        }
    });
</script>